<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Colabe Portfolio Dashboard</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
<header><h2>Colabe Solutions — Portfolio Dashboard</h2></header>
<div class="container">
  <div class="filters">
    <div><div class="muted">Ecosystem</div><select id="eco"></select></div>
    <div><div class="muted">Category</div><select id="cat"></select></div>
    <div><div class="muted">Status</div><select id="st"></select></div>
    <div><div class="muted">Go-Live Risk</div><select id="risk"></select></div>
    <div><div class="muted">Colabe Ecosystem</div><select id="colabe"></select></div>
    <div><div class="muted">Progress ≥ <span id="progVal">0%</span></div>
      <input id="prog" type="range" min="0" max="100" step="5" value="0">
    </div>
  </div>
  <div class="kpis">
    <div class="card"><div>Projects</div><div id="kpiP" class="val">0</div></div>
    <div class="card"><div>Avg Progress</div><div id="kpiProg" class="val">0%</div></div>
    <div class="card"><div>At Risk</div><div id="kpiRisk" class="val">0</div></div>
    <div class="card"><div>Off Track</div><div id="kpiOff" class="val">0</div></div>
  </div>
  <table id="grid">
    <thead><tr>
      <th>Project</th><th>ID</th><th>Ecosystem</th><th>Category</th><th>Status</th>
      <th>Progress</th><th>Estimated End</th><th>Preview Date</th><th>Production Date</th>
      <th>Go-Live Risk</th><th>Colabe Ecosystem</th>
    </tr></thead>
    <tbody></tbody>
  </table>
</div>
<script>
let RAW = [];

const ecoSel=document.getElementById('eco'),
      catSel=document.getElementById('cat'),
      stSel=document.getElementById('st'),
      rkSel=document.getElementById('risk'),
      colSel=document.getElementById('colabe'),
      progSl=document.getElementById('prog'),
      progVal=document.getElementById('progVal'),
      body=document.querySelector('#grid tbody');

function uniq(a){ return Array.from(new Set(a.filter(Boolean))).sort(); }
function get(v){ return v||""; }

function populateFilters(rows){
  ecoSel.innerHTML=["",...uniq(rows.map(r=>get(r["Ecosystem"])))].map(x=>`<option>${x||'All'}</option>`).join('');
  catSel.innerHTML=["",...uniq(rows.map(r=>get(r["Category"])))].map(x=>`<option>${x||'All'}</option>`).join('');
  stSel.innerHTML=["",...uniq(rows.map(r=>get(r["Status"])))].map(x=>`<option>${x||'All'}</option>`).join('');
  rkSel.innerHTML=["","On Track","At Risk","Off Track"].map(x=>`<option>${x||'All'}</option>`).join('');
  colSel.innerHTML=["","True","False"].map(x=>`<option>${x||'All'}</option>`).join('');
}

function applyFilters(){
  const e=ecoSel.value,c=catSel.value,s=stSel.value,r=rkSel.value,ce=colSel.value,p=parseInt(progSl.value);
  progVal.textContent=p+"%";
  const rows=RAW.filter(rw=>{
    if(e&&rw["Ecosystem"]!==e) return false;
    if(c&&rw["Category"]!==c) return false;
    if(s&&rw["Status"]!==s) return false;
    if(r&&rw["Go-Live Risk"]!==r) return false;
    if(ce&&String(rw["Colabe Ecosystem"])!==ce) return false;
    let pr=parseFloat(rw["Progress"]); if(isNaN(pr)) pr=0;
    if(pr<p) return false;
    return true;
  });
  render(rows);
}

function render(rows){
  body.innerHTML=rows.map(r=>`<tr>
    <td><a href="https://colabe.solutions/ppb/${get(r["Project ID"])}" target="_blank">${get(r["Project Name"])}</a></td>
    <td>${get(r["Project ID"])}</td>
    <td>${get(r["Ecosystem"])}</td>
    <td>${get(r["Category"])}</td>
    <td>${get(r["Status"])}</td>
    <td>${get(r["Progress"])}%</td>
    <td>${get(r["Estimated End Date"])}</td>
    <td>${get(r["Deployment Preview Date"])}</td>
    <td>${get(r["Deployment Production Date"])}</td>
    <td>${get(r["Go-Live Risk"])}</td>
    <td>${r["Colabe Ecosystem"]==="True"?"✅":"❌"}</td>
  </tr>`).join('');

  document.getElementById('kpiP').textContent=rows.length;
  const nums=rows.map(r=>parseFloat(r["Progress"])).filter(n=>!isNaN(n));
  const avg=nums.length?(nums.reduce((a,b)=>a+b,0)/nums.length).toFixed(1):"0.0";
  document.getElementById('kpiProg').textContent=avg+"%";
  document.getElementById('kpiRisk').textContent=rows.filter(r=>r["Go-Live Risk"]==="At Risk").length;
  document.getElementById('kpiOff').textContent=rows.filter(r=>r["Go-Live Risk"]==="Off Track").length;
}

// Load CSV dynamically
Papa.parse("colabe_projects_status_progress.csv", {
  download: true,
  header: true,
  complete: function(results){
    RAW = results.data;
    populateFilters(RAW);
    [ecoSel,catSel,stSel,rkSel,colSel,progSl].forEach(el=>el.addEventListener('input',applyFilters));
    applyFilters();
  }
});
</script>
</body>
</html>
